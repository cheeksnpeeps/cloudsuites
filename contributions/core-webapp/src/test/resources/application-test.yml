# Test Profile Configuration
# Overrides for testing environment
# =================================================================

logging:
  level:
    com.cloudsuites: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.flywaydb: DEBUG
    org.springframework.jdbc: DEBUG
    root: WARN  # Reduce noise in tests

spring:
  # Test Database Configuration (localhost for test containers)
  datasource:
    url: ${TEST_DATABASE_URL:jdbc:postgresql://localhost:59665/cloudsuites_test}
    username: ${TEST_DATABASE_USERNAME:csuser}
    password: ${TEST_DATABASE_PASSWORD:csPassw0rd}

  # Test R2DBC Configuration  
  r2dbc:
    url: ${TEST_R2DBC_URL:r2dbc:postgresql://localhost:59665/cloudsuites_test}
    username: ${TEST_DATABASE_USERNAME:csuser}
    password: ${TEST_DATABASE_PASSWORD:csPassw0rd}
    pool:
      initial-size: 2
      max-size: 5

  # Test Flyway Configuration
  flyway:
    url: ${TEST_DATABASE_URL:jdbc:postgresql://localhost:59665/cloudsuites_test}
    user: ${TEST_DATABASE_USERNAME:csuser}
    password: ${TEST_DATABASE_PASSWORD:csPassw0rd}
    enabled: true
    clean-disabled: false  # Allow clean for tests
    placeholders:
      partitioning.archive_storage_path: "/tmp/test-storage"

  # Test JPA Configuration
  jpa:
    properties:
      hibernate:
        hbm2ddl:
          auto: validate  # Use Flyway for tests too
        show_sql: false      # Reduce test output noise

# Test-specific external services (mock values)
twilio:
  accountSid: ${TEST_TWILIO_ACCOUNT_SID:test-account-sid}
  serviceSid: ${TEST_TWILIO_SERVICE_SID:test-service-sid}
  authToken: ${TEST_TWILIO_AUTH_TOKEN:test-auth-token}
  phoneNumber: ${TEST_TWILIO_PHONE_NUMBER:+1234567890}

jwt:
  secretKey: ${TEST_JWT_SECRET_KEY:dGVzdC1zZWNyZXQta2V5LWZvci10ZXN0aW5nLXB1cnBvc2VzLW9ubHk=}
  accessTokenValidityMs: 3600000   # 1 hour for tests
  refreshTokenValidityMs: 7200000  # 2 hours for tests

# Disable management endpoints in tests
management:
  endpoints:
    web:
      exposure:
        include: health,info

# Test storage
cloudsuites:
  storage:
    upload-path: /tmp/test-uploads
